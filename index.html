<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>CRM - Registro de Vendas</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
       /* ===== RESET / BASE ===== */
* {
    box-sizing: border-box;
    font-family: Arial, sans-serif;
}

body {
    margin: 0;
    background: #f4f6f8;
    color: #333;
}

/* ===== CONTAINER ===== */
.container {
    max-width: 480px;
    margin: auto;
    padding: 16px;
}

/* ===== TITULOS ===== */
h2 {
    font-size: 18px;
    margin: 20px 0 10px;
    border-bottom: 1px solid #ddd;
    padding-bottom: 6px;
}

/* ===== FORM ===== */
label {
    font-size: 14px;
    font-weight: bold;
    margin-top: 12px;
    display: block;
}

input,
textarea,
select {
    width: 100%;
    padding: 12px;
    margin-top: 6px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid #ccc;
}

textarea {
    resize: vertical;
    min-height: 80px;
}

input:disabled {
    background: #eee;
}

.checkbox {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 12px;
    font-size: 16px;
}

/* ===== BOTÕES ===== */
button {
    width: 100%;
    padding: 14px;
    margin-top: 20px;
    font-size: 18px;
    background: #1976d2;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
}

button:active {
    background: #125aa0;
}

.btn-excluir {
    background: #e53935;
    margin-top: 10px;
}

.btn-excluir:active {
    background: #c62828;
}

/* ===== CARDS ===== */
.card {
    background: white;
    padding: 14px;
    border-radius: 12px;
    margin-top: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}

/* ================================================= */
/* ================ DESKTOP ========================= */
/* ================================================= */
@media (min-width: 768px) {

    body {
        background: #e9ecef;
    }

    .container {
        max-width: 1100px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
        padding: 24px;
    }

    form {
        background: white;
        padding: 24px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    }

    #listaVendas {
        background: white;
        padding: 24px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        max-height: calc(100vh - 80px);
        overflow-y: auto;
    }

    button {
        font-size: 16px;
    }
}

    </style>
</head>
<body>

   <div class="container">

        <h1>Registro de Venda</h1>

        <form id="formVenda">

            <h2>Dados do Pedido</h2>

            <label>Nº do Pedido</label>
            <input type="text" id="pedido" disabled>

            <label>Data do Pedido</label>
            <input type="date" id="dataPedido" required>

            <label>Data da Entrega</label>
            <input type="date" id="dataEntrega" required>

            <div class="checkbox">
                <input type="checkbox" id="montagem">
                <label for="montagem">Montagem</label>
            </div>

            <hr>

            <h2>Produto</h2>

            <label>Modelo do Sofá</label>
            <textarea id="modelo" required></textarea>

            <label>Cor</label>
            <input type="text" id="cor" required>

            <label>Valor do Sofá</label>
            <input type="text" id="valorSofa" required>

            <label>Frete</label>
            <input type="text" id="frete" value="0">

            <label>Valor da Montagem</label>
            <input type="text" id="valorMontagem" value="0">

            <label>Total</label>
            <input type="text" id="total" disabled>

            <hr>

            <h2>Pagamento</h2>

            <label>Forma de Pagamento</label>
            <input type="text" id="pagamento" required>

            <hr>

            <h2>Cliente</h2>

            <label>Nome</label>
            <input type="text" id="nomeCliente" required>

            <label>Contato</label>
            <input type="text" id="contato" required>

            <label>CEP</label>
            <input type="text" id="cep">

            <label>Rua</label>
            <input type="text" id="rua">

            <label>Número</label>
            <input type="text" id="numero">

            <label>Cidade</label>
            <input type="text" id="cidade">

            <label>Bairro</label>
            <input type="text" id="bairro">

            <hr>

            <h2>Vendedora</h2>

            <select id="vendedora">
                <option>Débora</option>
                <option>Ana</option>
                <option>Paula</option>
            </select>

            <button type="submit">Salvar Venda</button>

        </form>

        <div>

            <h2>Vendas registradas</h2>
            <div id="listaVendas"></div>

        </div>

    </div>

    <script>

    function formatarMoeda(input) {
    let valor = input.value.replace(/\D/g, "");

    valor = (Number(valor) / 100).toFixed(2);

    valor = valor.replace(".", ",");
    valor = valor.replace(/\B(?=(\d{3})+(?!\d))/g, ".");

    input.value = "R$ " + valor;
}

function limparMoeda(valor) {
    return Number(
        valor
            .replace("R$", "")
            .replace(/\./g, "")
            .replace(",", ".")
            .trim()
    ) || 0;
}
        const form = document.getElementById("formVenda");
        const lista = document.getElementById("listaVendas");

        let vendas = JSON.parse(localStorage.getItem("vendas")) || [];


        function gerarNumeroPedido() {
    const proximo = (Number(localStorage.getItem("ultimoPedido")) || 0) + 1;
    document.getElementById("pedido").value = proximo;
}

        function calcularTotal() {
    const valor = limparMoeda(valorSofa.value);
    const freteValor = limparMoeda(frete.value);
    const montagemValor = montagem.checked
        ? limparMoeda(valorMontagem.value)
        : 0;

    const soma = valor + freteValor + montagemValor;

    total.value = soma.toLocaleString("pt-BR", {
        style: "currency",
        currency: "BRL"
    });
}

        valorSofa.addEventListener("input", () => {
    formatarMoeda(valorSofa);
    calcularTotal();
});

frete.addEventListener("input", () => {
    formatarMoeda(frete);
    calcularTotal();
});

valorMontagem.addEventListener("input", () => {
    formatarMoeda(valorMontagem);
    calcularTotal();
});
        montagem.onchange = calcularTotal;

        form.addEventListener("submit", function (e) {
            e.preventDefault();

          const numeroPedido =
    (Number(localStorage.getItem("ultimoPedido")) || 0) + 1;

localStorage.setItem("ultimoPedido", numeroPedido);  

         const venda = {
        pedido: numeroPedido,
        dataPedido: dataPedido.value,
        dataEntrega: dataEntrega.value,
        montagem: montagem.checked,

        produto: {
            modelo: modelo.value,
            cor: cor.value,
            valor: limparMoeda(valorSofa.value),
            frete: limparMoeda(frete.value),
            valorMontagem: montagem.checked
                ? limparMoeda(valorMontagem.value)
                : 0,
            total: limparMoeda(total.value)
        },

        pagamento: pagamento.value,

        cliente: {
            nome: nomeCliente.value,
            contato: contato.value,
            cep: cep.value,
            rua: rua.value,
            numero: numero.value,
            cidade: cidade.value,
            bairro: bairro.value
        },

        vendedora: vendedora.value
    };

    vendas.push(venda);
    localStorage.setItem("vendas", JSON.stringify(vendas));

    form.reset();
    gerarNumeroPedido();
    renderizarVendas();
});   

       function renderizarVendas() {
    lista.innerHTML = "";

    vendas.forEach(venda => {
        const div = document.createElement("div");
        div.className = "card";

        const nomeCliente = venda.cliente?.nome || "—";
        const produto = venda.produto?.modelo || "—";

        div.innerHTML = `
            <h3>Pedido Nº ${venda.pedido}</h3>
            <p><strong>Cliente:</strong> ${nomeCliente}</p>
            <p><strong>Produto:</strong> ${produto}</p>
            <p><strong>Total:</strong> ${Number(venda.produto?.total || 0)
                .toLocaleString("pt-BR", { style: "currency", currency: "BRL" })}</p>
            <p><strong>Vendedora:</strong> ${venda.vendedora || "—"}</p>

            <button class="btn-excluir" onclick="excluirPedido(${venda.pedido})">
                Excluir
            </button>
        `;

        lista.appendChild(div);
    });
} 

        function excluirPedido(pedido) {
            if (!confirm("Deseja excluir este pedido?")) return;

            vendas = vendas.filter(v => Number(v.pedido) !== Number(pedido));
            localStorage.setItem("vendas", JSON.stringify(vendas));
            renderizarVendas();
        }

        gerarNumeroPedido();
        renderizarVendas();
    </script> 

</body>
</html>